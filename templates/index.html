<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/static/css/styles.css" />
    <title>NZ Wildlife</title>
    <style>
        .star-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .star-button:hover {
            background: rgba(255, 215, 0, 0.9);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .star-button.favourited {
            background: rgba(255, 215, 0, 0.9);
            color: #fff;
        }

        .star-button.favourited:hover {
            background: rgba(255, 215, 0, 1);
        }

        .star-icon {
            color: #fff;
            transition: all 0.3s ease;
        }

        .star-button.favourited .star-icon {
            color: #fff;
        }

        .species-card {
            position: relative;
        }
    </style>
</head>
<body>
    <!-- Fixed header - NOW includes favourites link -->
    <header class="top-header">
        <div class="auth-links">
            <a href="/" class="auth-link active">HOME / KĀINGA</a>
            <a href="/favourites" class="auth-link">FAVOURITES / MAKAU</a>
            <a href="/login" class="auth-link">LOG IN / TAKIURU</a>
            <a href="/register" class="auth-link">REGISTER / REHITA</a>
        </div>
    </header>

    <!-- Main content - everything else goes here -->
    <main class="main-content">
        <h1>The NZ Wildlife Program <br> te kararehe hōtaka NZ</h1>
        
        <!-- Search form -->
        <form action="/species" method="get">
            <div class="search-container">
                <input type="text" id="search-box" name="name" class="search-input" placeholder="Search...">
                <button type="submit">Search / mohaha</button>
            </div>
            <br>
            <input type="hidden" name="field" value="species_name">
        </form>
        

        <h2>All Species Data / Raraunga Katoa</h2>
            
        <div class="species-grid">
            {% for item in species %}
            <div class="species-card">
                <button class="star-button" onclick="toggleFavourite({{ item[0] }})" id="star-{{ item[0] }}">
                    <span class="star-icon">☆</span>
                </button>
                <img src="{{ item[10] if item[10] and item[10] != '' else 'https://via.placeholder.com/400x300/4a3c28/f5f3f0?text=' + item[1]|urlencode }}" alt="{{ item[1] }} image" class="species-card-image">
                <div class="species-card-content">
                    <div class="species-card-title">{{ item[1] }}</div>
                    <div class="species-card-subtitle">{{ item[2] }}</div>
                    <div class="species-card-details">
                        <div class="species-card-detail">
                            <span class="species-card-label">Type:</span>
                            <span class="species-card-value">{{ item[3] }}</span>
                        </div>
                        <div class="species-card-detail">
                            <span class="species-card-label">Status:</span>
                            <span class="species-card-value">{{ item[7] }}</span>
                        </div>
                        <div class="species-card-detail">
                            <span class="species-card-label">Family:</span>
                            <span class="species-card-value">{{ item[8] }}</span>
                        </div>
                        <div class="species-card-detail">
                            <span class="species-card-label">Numbers:</span>
                            <span class="species-card-value">{{ item[9] }}</span>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <h2>Origin Status</h2>
        <div class="table-wrapper">
            <table border="1">
                <tr>
                    <th>ID</th>
                    <th>Origin Status</th>
                </tr>
                {% for item in origin_status %}
                <tr>
                    <td>{{ item[0] }}</td>
                    <td>{{ item[1] }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <h2>Species Type</h2>
        <table border="1">
            <tr>
                <th>ID</th>
                <th>Species Type</th>
            </tr>
            {% for item in species_type %}
            <tr>
                <td>{{ item[0] }}</td>
                <td>{{ item[1] }}</td>
            </tr>
            {% endfor %}
        </table>
    </main>

    <script>
        // Function to get favourites from localStorage
        function getFavourites() {
            const favourites = localStorage.getItem('wildlife_favourites');
            return favourites ? JSON.parse(favourites) : [];
        }

        // Function to save favourites to localStorage
        function saveFavourites(favourites) {
            localStorage.setItem('wildlife_favourites', JSON.stringify(favourites));
        }

        // Function to toggle favourite status
        function toggleFavourite(speciesId) {
            let favourites = getFavourites();
            const starButton = document.getElementById(`star-${speciesId}`);
            const starIcon = starButton.querySelector('.star-icon');
            
            const index = favourites.indexOf(speciesId);
            
            if (index > -1) {
                // Remove from favourites
                favourites.splice(index, 1);
                starButton.classList.remove('favourited');
                starIcon.textContent = '☆';
            } else {
                // Add to favourites
                favourites.push(speciesId);
                starButton.classList.add('favourited');
                starIcon.textContent = '★';
            }
            
            saveFavourites(favourites);
            
            // Add a little animation feedback
            starButton.style.transform = 'scale(1.3)';
            setTimeout(() => {
                starButton.style.transform = 'scale(1)';
            }, 200);
        }

        // Function to initialize star states on page load
        function initializeStars() {
            const favourites = getFavourites();
            
            favourites.forEach(speciesId => {
                const starButton = document.getElementById(`star-${speciesId}`);
                const starIcon = starButton?.querySelector('.star-icon');
                
                if (starButton && starIcon) {
                    starButton.classList.add('favourited');
                    starIcon.textContent = '★';
                }
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeStars();
            
            // Add active state styling for navigation
            const style = document.createElement('style');
            style.textContent = `
                .auth-link.active {
                    background: rgba(127, 176, 105, 0.2);
                    border-color: var(--accent-color);
                    color: var(--accent-color);
                }
            `;
            document.head.appendChild(style);
        });
    </script>

</body>
</html>